[gcode_macro SET_PA]
gcode:
  SET_PRESSURE_ADVANCE EXTRUDER=extruder ADVANCE={params.PA|default(0, true)}

[gcode_macro CALIBRATE_PA]
gcode:
  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.VELOCITY|default(5, true)} ACCEL={params.ACCEL|default(6600, true)}
  TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START={params.START|default(0.045, true)} FACTOR={params.FACTOR|default(0.003, true)}

[gcode_macro UNLOAD_FILAMENT]
gcode:
  SAVE_GCODE_STATE NAME=unload_state
  G91 ;relative positioning
  M117 Heating...
  M109 S{params.TEMP|default(230, true)} ; Heat up hotend to provided temp or 220 as default as that should work OK with most filaments.
  M117 Unloading filament...
  G0 E-5 F3600        ;extract filament to cold end area 
  G4 P3000            ;wait for three seconds
  G0 E5 F3600         ;push back the filament to smash any stringing 
  G0 E-15 F3600       ;Extract back fast in the cold zone 
  G0 E-130 F300       ;Continue extraction slowly, allow the filament time to cool solid before it reaches the gears
  M117 Filament unloaded!
  RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
gcode:
  SAVE_GCODE_STATE NAME=load_state
  G91 ;relative positioning
  M117 Heating...
  M109 S{params.TEMP|default(230, true)} ; Heat up hotend to provided temp or 220 as default as that should work OK with most filaments.
  M117 Loading filament...
  G0 E100 F600 ; Load the filament into the hotend area.
  G4 P1000
  G0 E40 F100 ; Purge
  M400
  TURN_OFF_HEATERS
  M117 Filament loaded!
  RESTORE_GCODE_STATE NAME=load_state

[gcode_macro EASY_PETG_06]
gcode:
  SET_PA PA=0.058
  SET_RETRACTION RETRACT_LENGTH=1.25

[gcode_macro EASY_PETG_04]
gcode:
  SET_PA PA=0.057
  SET_RETRACTION RETRACT_LENGTH=1.25

[gcode_macro PETG_04]
gcode:
  SET_PA PA=0.070
  SET_RETRACTION RETRACT_LENGTH=1.25

[gcode_macro PACF_04]
gcode:
  SET_PA PA=0.047
  SET_RETRACTION RETRACT_LENGTH=0.65

[gcode_macro TPU]
gcode:
  SET_PA PA=0.102
  SET_RETRACTION RETRACT_LENGTH=0